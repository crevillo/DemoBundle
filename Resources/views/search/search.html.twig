{#
    Search page
#}

{% extends "eZDemoBundle::pagelayout.html.twig" %}

{# Customized page title #}
{% block page_head %}
    {% set title = 'Search page'|trans %}
    {{ parent() }}
{% endblock %}

{% block content %}

<div class="content-search">

    <div class="attribute-header">
        <h1 class="long">{{ 'Search'|trans }}</h1>
    </div>

    {{ form_start( form, {'class': 'form-search'} ) }}
        {{ form_widget( form.searchText, { 'attr': {'class': 'input-xxlarge search-query'}} ) }}

        {{ form_widget( form.save, { 'label': "Search"|trans, 'attr': { 'class': 'btn' } } ) }}
    {{ form_end( form ) }}


    {# Link to advanced search, creating a link to a legacy module#}
    {% set advancedSearchUrl = '' %}

    {% if searchText %}
        {#TODO param in path() ?#}
        {% set advancedSearchUrl = '?SearchText=' ~ searchText %}
    {% endif %}

    {#TODO check xss#}
    <label>
        <a href={{ path( 'ez_legacy', {'module_uri': '/content/advancedsearch/' ~ advancedSearchUrl } ) }}>
            {{ 'For more options try the Advanced search'|trans }}
        </a>
    </label>

    {# TODO: Can we do that in the new stack ? #}
    {#{section show=$stop_word_array}#}
    {#<p>#}
        {#{"The following words were excluded from the search:"|i18n("design/ezdemo/content/search")}:#}
        {#{section name=StopWord loop=$stop_word_array}#}
        {#{$StopWord:item.word|wash}#}
        {#{delimiter}, {/delimiter}#}
        {#{/section}#}
    {#</p>#}
    {#{/section}#}

    {% if pagerSearch|length() > 0 %}

        <div class="feedback">
            <h2>{% trans %}Search for "%searchText%" returned %searchCount% matches{% endtrans %}</h2>
        </div>

        {% for searchResult in pagerSearch %}
            {# Displaying elements calling the view line #}
            {{ render_esi( controller( 'ez_content:viewLocation', {'locationId': searchResult.contentInfo.mainLocationId, 'viewType': 'line'} ) ) }}
        {% endfor %}

        {% if pagerSearch.haveToPaginate() %}
            <div class="pagination-centered">
                {{ pagerfanta( pagerSearch, 'twitter_bootstrap_translated' ) }}
            </div>
        {% endif %}
    {% else %}
        <div class="warning">
            <h2>{% trans %}No results were found when searching for "%searchText%".{% endtrans %}</h2>
        </div>
        <p>{{ 'Search tips'|trans }}</p>
        <ul>
            <li>{{ 'Check spelling of keywords.'|trans }}</li>
            <li>{{ 'Try changing some keywords (eg, "car" instead of "cars").'|trans }}</li>
            <li>{{ 'Try searching with less specific keywords.'|trans }}</li>
            <li>{{ 'Reduce number of keywords to get more results.'|trans }}</li>
        </ul>
    {% endif %}
</div>

{% endblock %}
